-- Script Farm Bond Liên Tục
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

-- Cấu hình
local TARGET_POSITION = Vector3.new(-428.75, 26.07, -49040.91)
local MOVEMENT_SPEED = 1000
local SCAN_INTERVAL = 0.1
local ARRIVAL_THRESHOLD = 5
local STUCK_TIMEOUT = 5 -- Giây
local FALLBACK_Y = -100 -- Giá trị Y khi bị kẹt

-- Khởi tạo
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- Hàm di chuyển siêu tốc cải tiến
local function TurboMoveTo(target)
    humanoid.WalkSpeed = MOVEMENT_SPEED
    humanoid.AutoRotate = false
    
    local startTime = os.clock()
    local lastPosition = humanoidRootPart.Position
    
    -- Tính hướng di chuyển
    local direction = (target - humanoidRootPart.Position).Unit
    humanoidRootPart.CFrame = CFrame.lookAt(humanoidRootPart.Position, humanoidRootPart.Position + direction)
    
    -- Bắt đầu di chuyển
    humanoid:MoveTo(target)
    
    -- Theo dõi di chuyển
    while humanoidRootPart and humanoid do
        local currentTime = os.clock()
        local distance = (humanoidRootPart.Position - target).Magnitude
        local movedDistance = (humanoidRootPart.Position - lastPosition).Magnitude
        
        -- Kiểm tra đến đích
        if distance < ARRIVAL_THRESHOLD then
            break
        end
        
        -- Kiểm tra bị kẹt
        if currentTime - startTime > STUCK_TIMEOUT and movedDistance < 10 then
            print("Phát hiện bị kẹt, kích hoạt chế độ khẩn cấp!")
            humanoidRootPart.CFrame = CFrame.new(
                humanoidRootPart.Position.X,
                FALLBACK_Y,
                humanoidRootPart.Position.Z
            )
            task.wait(0.5)
            startTime = os.clock() -- Reset timer
        end
        
        -- Cập nhật hướng di chuyển
        direction = (target - humanoidRootPart.Position).Unit
        humanoidRootPart.CFrame = CFrame.lookAt(humanoidRootPart.Position, humanoidRootPart.Position + direction)
        
        lastPosition = humanoidRootPart.Position
        RunService.Heartbeat:Wait()
    end
    
    humanoid.AutoRotate = true
end

-- Hàm quét bond nâng cao
local function EnhancedScan()
    local foundBond = false
    
    -- Quét tất cả đối tượng trong phạm vi
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("BasePart") and (obj.Name:lower():find("bond") or obj.Parent.Name:lower():find("bond")) then
            -- Canh chỉnh camera
            local camera = game.Workspace.CurrentCamera
            camera.CFrame = CFrame.lookAt(camera.CFrame.Position, obj.Position)
            
            -- Chạy script thu thập
            local success, err = pcall(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/Minh-code0807/HUB/main/Nh%E1%BA%B7t%20bond.lua"))()
            end)
            
            if success then
                print("Đã thu thập bond thành công!")
                foundBond = true
            else
                warn("Lỗi khi chạy script thu thập:", err)
            end
            
            break -- Chỉ xử lý 1 bond tại 1 thời điểm
        end
    end
    
    return foundBond
end

-- Chu trình chính liên tục
local function ContinuousFarm()
    while true do
        -- Di chuyển siêu tốc đến mục tiêu
        TurboMoveTo(TARGET_POSITION)
        
        -- Quét bond trong khi di chuyển
        local scanStart = os.clock()
        local foundBond = false
        
        while os.clock() - scanStart < STUCK_TIMEOUT do
            foundBond = EnhancedScan()
            if foundBond then
                break
            end
            task.wait(SCAN_INTERVAL)
        end
        
        -- Nếu không tìm thấy bond, tiếp tục di chuyển
        if not foundBond then
            print("Không tìm thấy bond, tiếp tục di chuyển...")
        end
    end
end

-- Xử lý respawn
player.CharacterAdded:Connect(function(newChar)
    character = newChar
    humanoid = newChar:WaitForChild("Humanoid")
    humanoidRootPart = newChar:WaitForChild("HumanoidRootPart")
    print("Đã respawn, tiếp tục farm...")
end)

-- Bắt đầu hệ thống
ContinuousFarm()
